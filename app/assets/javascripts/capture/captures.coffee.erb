# 画像並び替え
applyMasonry = (grid) ->
  return grid.masonry {
    itemSelector: '.grid-item',
    gutterWidth: 5,
    isAnimated: true,
    animationOptions: {
      duration: 500,
      easing: 'swing'
    },
  }

test = () ->
  applyMasonry $('#grid')

$ ->
  $grid = applyMasonry $('#grid')
  msnry = $grid.data 'masonry'

  # $grid.imagesLoaded ->
  #   $grid.masonry('option', { itemSelector: '.grid-item' })
  #   items = $grid.find('.grid-item')
  #   $grid.masonry('appended', items)

  $container = $grid.infiniteScroll {
    # loading: {
    #   img:     "<%= image_url "loading.gif" %>",
    #   msgText: ""
    # },
    path: '.pagination .next a',
    append: '.grid-item',
    outlayer: msnry,
    scrollThreshold: 400,
    hideNav: '.pagination',
    status: '.page-load-status',
  }
  $container.on( 'append.infiniteScroll', test )

$(document).on 'turbolinks:load', ->
  applyMasonry $('#grid')
